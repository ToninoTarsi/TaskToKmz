<html>
   <head>
      <title>Trofeo Monte Cucco 2013 - Task 1</title>
      <script src="https://www.google.com/jsapi"> </script> 
      <script src="http://earth-api-samples.googlecode.com/svn/trunk/lib/kmldomwalk.js" type="text/javascript"> </script>





      <script type="text/javascript">

      	 var href = 'http://www.vololiberomontecucco.it/docs/trofeo2013/task1.kmz';
         //var href = 'http://www.vololiberomontecucco.it/docs/05082013.kmz';
         
         var ge;
         var tour;
         var tours = new Array();

         google.load("earth", "1");

         function init() {
            google.earth.createInstance('map3d', initCB, failureCB);
         }

         function initCB(instance) {
            ge = instance;
            ge.getWindow().setVisibility(true);
            ge.getNavigationControl().setVisibility(ge.VISIBILITY_SHOW);

            enterTour();
         }

         function failureCB(errorCode) {
         }

         function addPilot(i,pilotName) {
        	 //alert(tour.getName());
        	 var pilotSelect =document.getElementById("pilot");
	         var option=document.createElement("option");
	         option.text= pilotName;
	         option.value = i;
	         try {
	           // for IE earlier than version 8
	           pilotSelect.add(option,pilotSelect.options[null]);
	         } catch (e) {
	        	 pilotSelect.add(option,null);
	         }
         }
         
         // Tour control functions.
         function enterTour() {
        	 
             google.earth.fetchKml(ge, href, fetchCallback);

             function fetchCallback(fetchedKml) {
                // Alert if no KML was found at the specified URL.
                if (!fetchedKml) {
                   setTimeout(function() {
                      alert('Bad or null KML');
                   }, 0);
                   return;
                }

                // Add the fetched KML into this Earth instance.
                ge.getFeatures().appendChild(fetchedKml);

                // Walk through the KML to find the tour object; assign to variable 'tour.'
                var i = 0;
                walkKmlDom(fetchedKml, function() {
                   if (this.getType() == 'KmlTour') {
                      tour = this;
                      tours[i] = this;
                      addPilot(i,tour.getName());
                      i++;
                      tours
 
                      //return false;
                   }
                });
                document.getElementById("playButton").disabled = false; 
                ge.getTourPlayer().setTour(tours[0]);
                //alert("pp");
             } 
        	 

 
         }
         
         function playTour() {
            ge.getTourPlayer().play();
         }
         function pauseTour() {
            ge.getTourPlayer().pause();
         }
         
         function resetTour() {
            ge.getTourPlayer().reset();
         }
         function exitTour() {
            ge.getTourPlayer().setTour(null);
         }

         function pilotChanged(){
        	  var myselect = document.getElementById("pilot");
        	  var pilotID = myselect.options[myselect.selectedIndex].value;
        	  
        	  var currentTime = ge.getTourPlayer().getCurrentTime();
        	  ge.getTourPlayer().setTour(tours[pilotID]);
        	  ge.getTourPlayer().setCurrentTime(currentTime);
        	  ge.getTourPlayer().play();
        	}
         
         google.setOnLoadCallback(init);
         
         
         
         
      </script>
   </head>
   <body>
     <div id ="controls">
     	 <input id="playButton" type="button" onclick="playTour()" value="Start" disabled/>
     	 <input type="button" onclick="pauseTour()" value="Pause"/>
     	
<!--          <input type="button" onclick="enterTour()" value="Task1"/> -->
         
         Select Pilot to follow: <select id="pilot" onchange="pilotChanged()">
         </select>
         
<!--          <input type="button" onclick="resetTour()" value="Stop/Reset Tour"/> -->
<!--          <input type="button" onclick="exitTour()" value="Exit Tour"/> -->
      </div>
      <hr>
      <div id="map3d" style="height: 100%; width: 100%;"></div>
 

   </body>
</html>